# CRM Backend 数据初始化功能

## 概述

本功能在 CRM 后端启动时自动初始化示例数据，让你可以直接开箱即用，无需手动创建测试数据。

## 功能特性

### 1. 自动创建示例用户
- **管理员账户**: `admin@example.com` / `admin123`
- **销售账户**: `sales1@example.com` / `sales123`
- **营销账户**: `marketing1@example.com` / `marketing123`

### 2. 自动创建示例客户
- 张三 (VIP客户, 企业客户)
- 李四 (普通客户, 个人客户)
- 王五 (潜在客户, 企业客户)
- 赵六 (黑名单客户)
- 钱七 (VIP客户, 长期合作)

### 3. 自动创建示例邮件任务
- 欢迎新客户邮件
- 产品推广邮件
- 客户关怀邮件

## 配置选项

在 `.env` 文件中添加以下配置：

```bash
# 数据初始化配置
INIT_SAMPLE_DATA=true  # 设置为 false 可禁用示例数据初始化
```

## 使用方法

### 启用自动初始化（默认）
```bash
INIT_SAMPLE_DATA=true
```

### 禁用自动初始化
```bash
INIT_SAMPLE_DATA=false
```

## 工作原理

1. 应用启动时，系统会检查数据库中是否已有数据
2. 如果数据库为空，系统会自动创建示例数据
3. 如果数据库中已有数据，系统会跳过初始化（避免重复创建）
4. 所有初始化过程都会记录详细的日志信息

## 安全注意事项

⚠️ **重要提醒**:
- 示例数据中的密码都是明文，仅用于开发测试
- 生产环境中请务必修改默认密码
- 建议在生产环境中禁用示例数据初始化

## 日志输出

启动时你会看到类似以下的日志信息：

```
2024-01-01 10:00:00 | INFO     | 服务启动成功
2024-01-01 10:00:00 | INFO     | 开始初始化数据表...
2024-01-01 10:00:00 | INFO     | 数据表初始化成功
2024-01-01 10:00:00 | INFO     | 开始初始化示例数据...
2024-01-01 10:00:00 | INFO     | 成功创建 3 个示例用户
2024-01-01 10:00:00 | INFO     | 成功创建 5 个示例客户
2024-01-01 10:00:00 | INFO     | 成功创建 3 个示例邮件任务
2024-01-01 10:00:00 | INFO     | 所有示例数据初始化完成！
2024-01-01 10:00:00 | INFO     | 默认管理员账户: admin@example.com / admin123
2024-01-01 10:00:00 | INFO     | 默认销售账户: sales1@example.com / sales123
2024-01-01 10:00:00 | INFO     | 默认营销账户: marketing1@example.com / marketing123
2024-01-01 10:00:00 | INFO     | 示例数据初始化完成
```

## 故障排除

### 问题：初始化失败
**解决方案**:
1. 检查数据库连接是否正常
2. 查看日志文件中的详细错误信息
3. 确保数据库表结构正确

### 问题：重复初始化
**解决方案**:
1. 系统会自动检测现有数据，不会重复创建
2. 如果仍有问题，检查 `INIT_SAMPLE_DATA` 配置

### 问题：密码无法登录
**解决方案**:
1. 确认使用的是示例账户和密码
2. 检查用户表是否正确创建
3. 查看启动日志确认用户创建成功

## 自定义示例数据

如需修改示例数据，可以编辑 `crm_backend/db/init_data.py` 文件中的相应函数。

## 技术支持

如有问题，请查看日志文件或联系开发团队。
